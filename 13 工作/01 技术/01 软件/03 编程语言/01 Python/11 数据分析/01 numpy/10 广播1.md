
# 广播 Broadcasting

广播是一种强大的机制，它允许numpy在执行算术运算时使用不同形状的数组。通常，我们有一个较小的数组和一个较大的数组，我们希望多次使用较小的数组来对较大的数组执行一些操作。



```python
import numpy as np

x = np.array([[1,2,3], [4,5,6], [7,8,9], [10, 11, 12]])
v = np.array([1, 0, 1])

y = np.empty_like(x)
for i in range(4):
    y[i, :] = x[i, :] + v
print(y)

vv = np.tile(v, (4, 1))
print(vv)
y = x + vv
print(y)

y = x + v
print(y)
```

- 例如，假设我们要向矩阵的每一行添加一个常数向量。我们可以这样做。但是当矩阵 `x` 非常大时，在Python中计算显式循环可能会很慢。
- `np.tile(v, (4, 1))` 将 v 拷贝成4行1列。
- `y = x + v` 使用了 broadcasting。即使 `x` 具有形状`(4，3)` 和 `v` 具有形状 `(3,)`，但由于广播的关系，该行的工作方式就好像 `v` 实际上具有形状`(4，3)`，其中每一行都是 `v` 的副本，并且求和是按元素执行的。

将两个数组一起广播遵循以下规则：

- 如果数组不具有相同的rank，则将较低等级数组的形状添加1，直到两个形状具有相同的长度。
- 如果两个数组在维度上具有相同的大小，或者如果其中一个数组在该维度中的大小为1，则称这两个数组在维度上是兼容的。
- 如果数组在所有维度上兼容，则可以一起广播。
- 广播之后，每个数组的行为就好像它的形状等于两个输入数组的形状的元素最大值。
- 在一个数组的大小为1且另一个数组的大小大于1的任何维度中，第一个数组的行为就像沿着该维度复制一样


应用：

```python
import numpy as np

v = np.array([1, 2, 3])
m = np.reshape(v, (3, 1))
w = np.array([4, 5])
print(m)
print(m * w)  # broadcast to (3,2)
print()

x = np.array([[1, 2, 3], [4, 5, 6]])
print(x + v)  # broadcast to (2, 3)
print((x.T + w).T)
print(x + np.reshape(w, (2, 1)))
print()

print(x * 2)
```

输出：

```txt
[[1]
 [2]
 [3]]
[[ 4  5]
 [ 8 10]
 [12 15]]

[[2 4 6]
 [5 7 9]]
[[ 5  6  7]
 [ 9 10 11]]
[[ 5  6  7]
 [ 9 10 11]]

[[ 2  4  6]
 [ 8 10 12]]
```

说明：

- 广播通常会使你的代码更简洁，效率更高，因此你应该尽可能地使用它。



