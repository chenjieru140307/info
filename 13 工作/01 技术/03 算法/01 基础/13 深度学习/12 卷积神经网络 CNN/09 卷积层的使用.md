# 卷积层的使用



## 卷积核尺寸选择

- 在大多数情况下，可以通过堆叠较小的卷积核来代替直接采用单个更大的卷积核。
  - 但是，这并不是表示更大的卷积核就没有作用，在某些领域应用卷积神经网络时仍然可以采用较大的卷积核。
    - 譬如在自然语言处理领域，由于文本内容不像图像数据可以对特征进行很深层的抽象，往往在该领域的特征提取只需要较浅层的神经网络即可。在将卷积神经网络应用在自然语言处理领域时，通常都是较为浅层的卷积层组成，但是文本特征有时又需要有较广的感受域让模型能够组合更多的特征（如词组和字符），此时直接采用较大的卷积核将是更好的选择。
- 卷积核的大小并没有绝对的优劣，需要视具体的应用场景而定，但是极大和极小的卷积核都是不合适的，
  - 单独的 $1\times 1$ 极小卷积核只能用作分离卷积而不能对输入的原始特征进行有效的组合，$1\times1$ 卷积说明：
    - 作用：
      - 实现信息的跨通道交互和整合。
      - 对卷积核通道数进行降维和升维，减小参数量。<span style="color:red;">只是对通道数进行升维和降维，感觉并没有减少很多参数量吧。</span>
    - 举例：
      - GoogLeNet 采用 $1\times1​$ 卷积核来减少模型的参数量。在原始版本的 Inception 模块中，由于每一层网络采用了更多的卷积核，大大增加了模型的参数量。此时在每一个较大卷积核的卷积层前引入 $1\times1​$ 卷积，可以通过分离通道与宽高卷积来减少模型参数量。<span style="color:red;">怎么通过分离通道和宽高卷积来减少模型参数量的？</span>
      - 如图：Inception模块
        <p align="center">
            <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190722/2b6uhdp5Kyak.png?imageslim">
        </p>
      - 说明：
        - 在不考虑参数偏置项的情况下，若输入和输出的通道数为 $C_1=16​$，则：
          - 左半边网络模块所需的参数为 $(1\times1+3\times3+5\times5+0)\times C_1\times C_1=8960​$；
          - 假定右半边网络模块采用的 $1\times1​$ 卷积通道数为 $C_2=8​$ (满足 $C_1>C_2$)​，则右半部分的网络结构所需参数量为 $(1\times1\times (3C_1+C_2)+3\times3\times C_2 +5\times5\times C_2)\times C_1=5248​$。 <span style="color:red;">这个 式子为什么是这么计算的？嗯，理解了，但是为什么要满足 $C_1>C_2$？这个跟输出为 $C_1=16​$ 有差别呀？ </span>
  - 极大的卷积核通常会组合过多的无意义特征从而浪费了大量的计算资源。
  - 比较常用的有：3×3卷积核。


## 卷积核的整合：


如图 5.3所示，输入的特征在同一层分别经过 $1×1$、$3×3$ 和 $5×5$ 三种不同尺寸的卷积核，再将分别得到的特征进行整合，得到的新特征可以看作不同感受域提取的特征组合，相比于单一卷积核会有更强的表达能力。

Inception 模块结构：

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190722/mEa58UyHhRuh.png?imageslim">
</p>



## 如何减少卷积层参数量：

- 使用堆叠小卷积核代替大卷积核：VGG 网络中 2 个 $3\times 3$ 的卷积核可以代替 1 个 $5\times 5$ 的卷积核
- 使用分离卷积操作：将原本 $K\times K\times C$ 的卷积操作分离为 $K\times K\times 1$ 和 $1\times1\times C$ 的两部分操作。<span style="color:red;">嗯，理解了，先是 $1$ 个 $K\times K$ 的卷积核在 $C$ 个 $H \times W$ 的图像上分别卷积，得到 $C$ 个 $H \times W$ 的图像输出，然后再用 $C$ 个 $1\times1$ 卷积核再对这输出的 $C$ 个图像分别卷积，对应的结果相加，得到一个 $H \times W$ 的图像。不错。</span>
- 添加 $1\times 1$ 的卷积操作：与分离卷积类似，但是通道数可变，在 $K\times K\times C_1$ 卷积前添加 $1\times1\times C_2$ 的卷积核（满足 $C_2 <C_1$）<span style="color:red;">为什么要保证 $C_2 <C_1$ 呢？只是为了降低通道数吗？还是说有别的限制？</span>
- 在卷积层前使用池化操作：池化可以降低卷积层的输入特征维度。<span style="color:red;">是的。</span>


