# 条件概率与贝叶斯公式

## 条件概率

公式：

$$P(A\mid B)=\frac{P(AB)}{P(B)}$$

文氏图：

<p align="center">
    <img width="50%" height="70%" src="http://images.iterate.site/blog/image/20190722/r5vg2SQEzvUM.jpg?imageslim">
</p>

说明：

- 即，在事件 $B$ 发生的情况下，事件 $A$ 发生的概率就是 $P(A\bigcap B)$ 除以 $P(B)$。



​举例：

- 一对夫妻有两个小孩，已知其中一个是女孩，则另一个是女孩子的概率是多少？

解答：

- 穷举法：已知其中一个是女孩，那么样本空间为男女，女女，女男，则另外一个仍然是女生的概率就是 1/3。
- 条件概率法：$P(女|女)=P(女女)/P(女)$
  - 夫妻有两个小孩，那么它的样本空间为女女，男女，女男，男男，
  - 则 $P(女女)$ 为 $1/4$，$P(女)= 1-P(男男)=3/4$。（为什么 $P(女)$ 为 $3/4$，如果说，$P(女)$ 为 存在 女孩的概率，那么就可以理解。）
  - 所以 $P(女|女)$ 为 $1/3$。



### 条件概率的链式法则

由：

$$
P(AB) = P(B|A)P(A)
$$

推广到：

$$
P(ABC)=P(C|AB)P(B|A)P(A)
$$


$$
\begin{aligned}
P(A_1A_2...A_n)=&P(A_n|A_1A_2...A_{n-1})P(A_{n-1}|A_1A_2...A_{n-2})...P(A_2|A_1)P(A_1)
\\=&P(A_1)\prod_{i=2}^{n}P(A_i|A_1A_2...A_{i-1})
\end{aligned}
$$

说明：

- 任何多维随机变量联合概率分布，都可以分解成只有一个变量的条件概率相乘的形式。




## 全概率公式

- 假设 $\{B_n:n=1,2,3,\cdots \}$ 是一个概率空间的有限或者可数无限的分割，且每个集合 $B_n$ 是一个可测集和。
- 则对任意事件 $A$ 有全概率公式：

$$
\begin{aligned}
P(A)=&\sum_{n}P(A\cap B_n)
\\=& \sum_{n}P(A\mid B_{n})P(B_{n})
\end{aligned}
$$

说明：

- 第一行到第二行：条件概率公式。

作用：

- 全概率公式将求解 $A$ 的概率问题，转化为了在不同情况或不同原因 $B_n$ 下发生的 $A$ 的求和问题。



## 贝叶斯公式

贝叶斯公式 Bayes

由条件概率：

$$
\begin{aligned}
P(AB)=&P(A\mid B)P(B)
\\=&P(B\mid A)P(A)
\end{aligned}
$$

所以：（贝叶斯公式）


$$
P(A|B)=\frac{P(B|A)P(A)}{P(B)}
$$
$$
P(B|A)=\frac{P(A|B)P(B)}{P(A)}
$$

对于上面第二个式子，将全概率公式带入，得到：


$$P(B_n\mid A)=\frac{P(A\mid B_n)P(B_n)}{\sum_{n}P(A\mid B_{n})P(B_{n})}$$


作用：

- 本来是 $A$ 发生的时候 $B_n$ 发生的概率，即 $B_n$ 是原因，$A$是结果，但是现在 $A$ 是原因，$B_n$ 是结果。（是这样吗？）


举例：

- 支步枪中有 5 支已校准过，3支未校准。
- 一名射手用校准过的枪射击，中靶概率为 0.8；
- 用未校准的枪射击，中靶概率为 0.3
- 现从 8 支枪中随机取一支射击，结果中靶
- 求该枪是已校准过的概率

解答：

- 求解 $P(G=1 | A=1)=?$
  - G 为枪是否已校准，A 为是否中靶。
- 已知
  - $P(G=1)=\frac{5}{8}$，$P(G=0)=\frac{3}{8}$
  - $P(A=1 | G=1)=0.8$，$P(A=0 | G=1)=0.2$
  - $P(A=1 | G=0)=0.3$，$P(A=0 | G=0)=0.7$
- 则：
  $$
  \begin{aligned}
  P(G=1 | A=1)=&\frac{P(A=1 | G=1) P(G=1)}{\sum_{i \in G} P(A=1 | G=i) P(G=i)}
  \\=&\frac{0.8 \times \frac{5}{8}}{0.8 \times \frac{5}{8}+0.3 \times \frac{3}{8}}
  \\=&0.8163
  \end{aligned}
  $$


### 频率学派与贝叶斯学派：

- 给定某个系统的若干样本，求该系统的参数。怎么求？

可以的方法：（没有很清楚）

- 可以用：矩估计/MLE/MaxEnt/EM等：即假定参数是某个/某些未知的定值，求这些参数如何取值，能够使得某目标函数取极大/极小。（MLE，MaxEnt，EM 补充下）
  - 这种就属于频率学派。
- 也可以用：贝叶斯模型来求：假定参数本身是变化的，服从某个分布。求在这个分布约束下使得某目标函数极大/极小。
  - 这种就属于贝叶斯学派。

### 朴素贝叶斯 与 贝叶斯

（没有很清楚，补充）

朴素贝叶斯假定了大量的独立性，而贝叶斯则是实际中是什么样子就做成什么样子。


## 先验概率 后验概率 似然函数 极大似然函数


给定某系统的若干样本 $x$，计算该系统的参数 $\theta$，即：

$$P(\theta \mid x)=\frac{P(x\mid \theta)P(\theta )}{P(x)}$$

此时：

- 先验概率：就是没有给定任何信息，你想猜这个概率，没有任何东西可言，比如没有任何信息猜一个人姓什么。
  - 对应式子中就是：$P(\theta)$，即在没有数据支持的情况下，$\theta$发生的概率。
- 后验概率：就是有了一些知识之后猜的概率，比如某人来自牛家村，那么姓牛的概率就比较大，这个就是后验概率，但是他虽然来自牛家村也可能姓马，所以不管先验后验都可能出错的，不是一定对的。
  - 对应式子中就是：$P(\theta\mid x)$：在数据 $x$ 的支持下，$\theta$ 发生的概率。
- 似然函数：在某一个参数的情况下，样本的发生概率就是似然函数。（没有很清楚）
  - 式子中的 $P(x\mid\theta)$ 在给定某个参数 $\theta$ 下的概率分布就是似然函数。

即：

- 给定某些样本 D，产生这些样本，有几种结论，$\mathrm{A}_{1},\mathrm{A}_{2} \ldots \mathrm{A}_{\mathrm{n}}$，每个结论出现的概率为 $\mathrm{P}\left(\mathrm{A}_{\mathrm{i}} | \mathrm{D}\right)$，想求解，根据这些样本，我们能得出的出现概率最大的结论 $\max P\left(A_{i} | D\right)$。

计算：

$$
\begin{aligned}
\max P\left(A_{i} | D\right)=&\max \frac{P\left(D | A_{i}\right) P\left(A_{i}\right)}{P(D)}
\\=&\max \left(P\left(D | A_{i}\right) P\left(A_{i}\right)\right) 
\\\rightarrow& \max P\left(D | A_{i}\right)
\end{aligned}
$$

说明：

- 第一行：贝叶斯公式
- 第一行到第二行：样本给定的情况下，对任何的 $A_{i}$，$P(D)$ 是常数。
- 第二行到第三行，这里我们假定这些结论 $\mathrm{A}_{1}, \mathrm{A}_{2} \ldots \mathrm{A}_{\mathrm{n}}$ 的先验概率相同（或近似）。那么可以将 $P\left(A_{i}\right)$ 消去。（为什么可以假定它们的先验概率是相同的？）
- $\max P\left(A_{i} | D\right) \rightarrow \max P\left(D | A_{i}\right)$ 指的是：在给定数据的时候，我们想去看一下哪一条结论是最有可能发生的。但是我们往往算的是反方向，在 $A_i$ 给定的时候这个数据出现的极大值。
- 这个 $\max P\left(D | A_{i}\right)$ 就是极大似然估计。（还没有很清楚）

极大似然估计：

- 极大似然估计其实是先验性的假定了 $\mathrm{A}_{1}, \mathrm{A}_{2} \ldots \mathrm{A}_{\mathrm{n}}$ 出现的概率是相同的。



但是在贝叶斯学派中，最多的是探讨先验概率 $P(A_i)$ 如果是不相等的时候如何进行建模的问题。（怎么知道是不是相等的？不是相等的情况下怎么建模？）

