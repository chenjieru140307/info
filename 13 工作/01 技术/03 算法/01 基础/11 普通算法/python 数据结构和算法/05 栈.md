
# æ ˆ

æ ˆè¿™ä¸ªè¯å®é™…ä¸Šåœ¨è®¡ç®—æœºç§‘å­¦é‡Œä½¿ç”¨å¾ˆå¤šï¼Œé™¤äº†æ•°æ®ç»“æ„å¤–ï¼Œè¿˜æœ‰å†…å­˜é‡Œçš„æ ˆåŒº ï¼ˆå’Œå †å¯¹åº”ï¼‰ï¼Œç†Ÿæ‚‰ C ç³»è¯­è¨€çš„è¯åº”è¯¥ä¸ä¼šé™Œç”Ÿã€‚
ä¸Šä¸€ç« æˆ‘ä»¬è®²åˆ°äº†å…ˆè¿›å…ˆå‡º queueï¼Œå…¶å®ç”¨ python çš„å†…ç½®ç±»å‹ collections.deque æˆ–è€…æˆ‘ä»¬è‡ªå·±å®ç°çš„ LinkedList æ¥å®ç°å®ƒéƒ½å¾ˆç®€å•ã€‚
æœ¬ç« æˆ‘ä»¬è®²è®² åè¿›å…ˆå‡ºçš„æ ˆã€‚

ç”Ÿæ´»ä¸­çš„æ•°æ®ç»“æ„ï¼š

- æ ˆã€‚å¥½æ¯”åœ¨æ¡¶é‡Œå¤´æ”¾ç›˜å­ï¼Œå…ˆæ”¾çš„ç›˜å­æ”¾åœ¨äº†åº•ä¸‹ï¼Œåæ¥çš„ç›˜å­æ”¾åœ¨ä¸Šè¾¹ã€‚ä½ è¦æ‹¿çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å…ˆæ‹¿æœ€ä¸Šè¾¹çš„ã€‚

æ ˆå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºåŸºç¡€æ“ä½œå°±ä¿©ï¼Œä¸€ä¸ª push å’Œä¸€ä¸ª popï¼Œå’¦ï¼Œå’‹å’Œé˜Ÿåˆ—ä¸€æ ·çš„ï¼Ÿ
ç¡®å®æ–¹æ³•åå­—ä¸€æ ·ï¼Œä½†æ˜¯å¾—åˆ°çš„ç»“æœå¯æ˜¯ä¸åŒçš„ã€‚


# æ ˆ ADT

ä¸Šä¸€ç« æˆ‘ä»‹ç»äº†æˆ‘ä»¬æ€æ ·é€‰å–æ°åˆ°çš„æ•°æ®ç»“æ„æ¥å®ç°æ–°çš„ ADTï¼Ÿä½ èƒ½æƒ³åˆ°è¿™é‡Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä¹‹å‰æåˆ°çš„å“ªä¸ªæ•°æ®ç»“æ„æ¥å®ç°å—ï¼Ÿ
ä½ çš„å¤§è„‘å¯èƒ½å¼€å§‹é«˜(gui)é€Ÿ(su)æ—‹è½¬äº†ï¼Œä¸Šå‡ ç« å­¦è¿‡çš„ array, list, deque, LinkedList, CircularDoubleLinkedList, queue
ç­‰åœ¨å¤§è„‘é‡Œå‘¼å•¸è€Œè¿‡ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½å·²ç»ä¸€è„¸æ„å®¹äº†ï¼Œåˆ°åº•è¯¥é€‰å•¥ï¼Ÿ

è¿˜ç”¨é—®å˜›ï¼Œå½“ç„¶æ˜¯æ—¶é—´å¤æ‚åº¦æœ€å°çš„å•¦ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç©ºé—´éƒ½æ˜¯å¤Ÿç”¨çš„ã€‚
å…¶å®ä½ ä¼šå‘ç°æ ˆæ¯”é˜Ÿåˆ—è¿˜ç®€å•ï¼Œå› ä¸ºå®ƒåªåœ¨é¡¶ä¸Šæ“ä½œï¼ˆæƒ³è±¡è£…ç€ç›˜å­çš„æ¡¶ï¼‰ï¼Œå¦‚æœæœ‰ä¸€ç§æ•°æ®ç»“æ„èƒ½æ–¹ä¾¿åœ¨å°¾éƒ¨å¢å‡å…ƒç´ ä¸å°±æ»¡è¶³éœ€æ±‚äº†å—ã€‚
è¿™ä¸ªæ—¶å€™å¦‚æœä½ å¿˜è®°äº†ï¼Œå¯ä»¥ç¿»ç¿»å‰å‡ ç« ï¼Œçœ‹çœ‹å“ªä¸ªæ•°æ®ç»“æ„ç¬¦åˆè¦æ±‚ã€‚

æƒ³ä¸€ä¸‹ï¼Œä¼¼ä¹ CircularDoubleLinkedList å¾ªç¯åŒç«¯é˜Ÿåˆ—æ˜¯æ»¡è¶³çš„ï¼Œå› ä¸ºå¢åˆ æœ€åä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ O(1)ã€‚
ä¸è¿‡çœ‹äº†ä¸‹ç¤ºä¾‹ä»£ç ï¼Œä¼¼ä¹æ²¡æœ‰ pop() æ–¹æ³•ï¼Œå¯¹ï¼Œå› ä¸ºæˆ‘å·²ç»æŠŠå®ç° deque ä½œä¸ºæ€è€ƒé¢˜äº†ã€‚ğŸ˜‚
å¦‚æœä¹‹å‰ä½ æ²¡å†™å‡ºæ¥ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šå†å®ç°å®ƒã€‚


è§†é¢‘é‡Œæˆ‘ä»¬å°†å€ŸåŠ© CircularDoubleLinkedList å®ç° åŒç«¯é˜Ÿåˆ— Deque ï¼Œå¹¶ä¸”ç”¨ Deque å®ç° Stackã€‚

```py
# -*- coding: utf-8 -*-

# NOTE: è¿™é‡Œæ‹·è´çš„ double_link_list.py é‡Œçš„ä»£ç 

from collections import deque


class Node(object):

    def __init__(self, value=None, prev=None, next=None):
        self.value, self.prev, self.next = value, prev, next


class CircularDoubleLinkedList(object):
    """å¾ªç¯åŒç«¯é“¾è¡¨ ADT
    å¤šäº†ä¸ªå¾ªç¯å…¶å®å°±æ˜¯æŠŠ root çš„ prev æŒ‡å‘ tail èŠ‚ç‚¹ï¼Œä¸²èµ·æ¥
    """

    def __init__(self, maxsize=None):
        self.maxsize = maxsize
        node = Node()
        node.next, node.prev = node, node
        self.root = node
        self.length = 0

    def __len__(self):
        return self.length

    def headnode(self):
        return self.root.next

    def tailnode(self):
        return self.root.prev

    def append(self, value):    # O(1), ä½ å‘ç°ä¸€èˆ¬ä¸ç”¨ for å¾ªç¯çš„å°±æ˜¯ O(1)ï¼Œæœ‰é™ä¸ªæ­¥éª¤
        if self.maxsize is not None and len(self) >= self.maxsize:
            raise Exception('LinkedList is Full')
        node = Node(value=value)
        tailnode = self.tailnode() or self.root

        tailnode.next = node
        node.prev = tailnode
        node.next = self.root
        self.root.prev = node
        self.length += 1

    def appendleft(self, value):
        if self.maxsize is not None and len(self) >= self.maxsize:
            raise Exception('LinkedList is Full')
        node = Node(value=value)
        if self.root.next is self.root:   # empty
            node.next = self.root
            node.prev = self.root
            self.root.next = node
            self.root.prev = node
        else:
            node.prev = self.root
            headnode = self.root.next
            node.next = headnode
            headnode.prev = node
            self.root.next = node
        self.length += 1

    def remove(self, node):      # O(1)ï¼Œä¼ å…¥ node è€Œä¸æ˜¯ value æˆ‘ä»¬å°±èƒ½å®ç° O(1) åˆ é™¤
        """remove
        :param node  # åœ¨ lru_cache é‡Œå®é™…ä¸Šæ ¹æ® key ä¿å­˜äº†æ•´ä¸ª node:
        """
        if node is self.root:
            return
        else:    #
            node.prev.next = node.next
            node.next.prev = node.prev
        self.length -= 1
        return node

    def iter_node(self):
        if self.root.next is self.root:
            return
        curnode = self.root.next
        while curnode.next is not self.root:
            yield curnode
            curnode = curnode.next
        yield curnode

    def __iter__(self):
        for node in self.iter_node():
            yield node.value

    def iter_node_reverse(self):
        """ç›¸æ¯”å•é“¾è¡¨ç‹¬æœ‰çš„ååºéå†"""
        if self.root.prev is self.root:
            return
        curnode = self.root.prev
        while curnode.prev is not self.root:
            yield curnode
            curnode = curnode.prev
        yield curnode


############################################################
# åˆ†å‰²çº¿ï¼Œä¸‹è¾¹æ˜¯æœ¬ç«  å†…å®¹å®ç°
############################################################


class Deque(CircularDoubleLinkedList):   # æ³¨æ„è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†ç»§æ‰¿ï¼Œå—¯ï¼Œè²Œä¼¼æˆ‘è¯´è¿‡ä¸ä¼šç”¨å•¥ OOP ç‰¹æ€§çš„ï¼ŒæŠ±æ­‰

    def pop(self):
        """åˆ é™¤å°¾èŠ‚ç‚¹"""
        if len(self) == 0:
            raise Exception('empty')
        tailnode = self.tailnode()
        value = tailnode.value
        self.remove(tailnode)
        return value

    def popleft(self):
        if len(self) == 0:
            raise Exception('empty')
        headnode = self.headnode()
        value = headnode.value
        self.remove(headnode)
        return value


def test_deque():
    dq = Deque()
    dq.append(1)

    dq.append(2)
    assert list(dq) == [1, 2]

    dq.appendleft(0)
    assert list(dq) == [0, 1, 2]

    dq.pop()
    assert list(dq) == [0, 1]

    dq.popleft()
    assert list(dq) == [1]

    dq.pop()
    assert len(dq) == 0


class Stack(object):
    def __init__(self):
        self.deque = Deque()   # ä½ å¯ä»¥å¾ˆå®¹æ˜“æ›¿æ¢ä¸º python å†…ç½®çš„ collections.deque

    def push(self, value):
        self.deque.append(value)

    def pop(self):
        return self.deque.pop()


class Stack2(object):

    def __init__(self):
        self._deque = deque()

    def push(self, value):
        return self._deque.append(value)

    def pop(self):
        return self._deque.pop()

    def empty(self):
        return len(self._deque) == 0


def test_stack():
    s = Stack()
    s.push(0)
    s.push(1)
    s.push(2)

    assert s.pop() == 2
    assert s.pop() == 1
    assert s.pop() == 0

    import pytest    # pip install pytest
    with pytest.raises(Exception) as excinfo:   # æˆ‘ä»¬æ¥æµ‹è¯•æ˜¯å¦çœŸçš„æŠ›å‡ºäº†å¼‚å¸¸
        s.pop()
    assert 'empty' in str(excinfo.value)


if __name__ == '__main__':
    test_stack()

```

# Stack over flow ä»€ä¹ˆé¬¼ï¼Ÿ

å—¯ï¼Œstackoverflow ä¸æ˜¯ä¸€ä¸ªç¨‹åºå‘˜é—®ç­”ç½‘ç«™å—ï¼Ÿæ²¡é”™ã€‚
å‡½æ•°çš„ä¸´æ—¶å˜é‡æ˜¯å­˜å‚¨åœ¨æ ˆåŒºçš„ï¼Œå¦‚æœä½ ä¸å¹¸å†™äº†ä¸€ä¸ªæ²¡æœ‰å‡ºå£çš„é€’å½’å‡½æ•°ï¼Œå°±ä¼šè¿™ä¸ªé”™ã€‚ä¸ä¿¡ä½ è¯•è¯•ï¼š


```py
def infinite_fib(n):
    return infinite_fib(n-1) + infinite_fib(n-2)
infinite_fib(10)
```

ä¸€å¤§æ®µè¾“å‡ºä¹‹åå°±ä¼šå‡ºç°å¼‚å¸¸ï¼š RecursionError: maximum recursion depth exceededã€‚
åè¾¹ä¼šè®²åˆ°é€’å½’ï¼Œé€’å½’æ˜¯åˆå­¦è€…æ¯”è¾ƒéš¾ç†è§£çš„æ¦‚å¿µï¼Œåœ¨æ ‘çš„éå†ç­‰åœ°æ–¹è¿˜ä¼šçœ‹åˆ°å®ƒã€‚


# æ•°æ®ç»“æ„å¤´è„‘é£æš´æ³•

å½“æˆ‘ä»¬ä¸çŸ¥é“ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œã€Šç¨‹åºå‘˜é¢è¯•é‡‘å…¸ã€‹è¿™æœ¬ä¹¦çš„ç¬¬å…­ç« æåˆ°äº†ä¸€ç§æ–¹å¼å«åšã€æ•°æ®ç»“æ„å¤´è„‘é£æš´æ³•ã€ã€‚
è¿™ç§ç¬¨æ–¹æ³•å°±æ˜¯å¿«é€Ÿè¿‡ä¸€éæ•°æ®ç»“æ„çš„åˆ—è¡¨ï¼Œç„¶åé€ä¸€å°è¯•å„ç§æ•°æ®ç»“æ„çœ‹çœ‹å“ªä¸ªæœ€é€‚åˆã€‚

åœ¨ä½ å®ç°ä¸€ä¸ªæ›´é«˜çº§çš„æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå¦‚æœè„‘å­æ²¡æœ‰æ€è·¯ï¼Œä¸å¦¨å°è¯•ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œè¿…é€Ÿè¿‡ä¸€éä½ æ‰€çŸ¥é“çš„æ•°æ®ç»“æ„ï¼Œçœ‹çœ‹å“ªç§æœ€é€‚åˆã€‚(ä»æ¯ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦åˆ†æå¯»æ‰¾æœ€ä¼˜è§£)

# æ€è€ƒé¢˜
- ä¸Šä¸€ç« æˆ‘ä»¬ç”¨æ•°ç»„å®ç°äº†é˜Ÿåˆ—ï¼Œå…¶å®ä¹Ÿèƒ½ç”¨æ•°ç»„æ¥å®ç°æ ˆï¼Œä½ èƒ½è‡ªå·±ç”¨æ•°ç»„æ¥å®ç°ä¸€ä¸ªæ ˆçš„ ADT å—ï¼Ÿ
- å®é™…ä¸Šå€ŸåŠ© python å†…ç½®çš„ list/collections.deque ç»“æ„å°±å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªæ ˆï¼Œè¯·ä½ å°è¯•å®ç°ï¼Œæœ¬ç« æˆ‘ä»¬å…¨éƒ¨ä½¿ç”¨è‡ªå·±ç¼–å†™çš„æ•°æ®ç»“æ„è€Œæ²¡ç”¨åˆ° python å†…ç½®çš„æ•°æ®ç»“æ„ã€‚
- è¿™é‡Œæˆ‘ä»¬è‡ªå·±å®ç°äº† Dequeï¼Œä½ èƒ½ç”¨ python å†…ç½®çš„ collections.deque å®ç°æ ˆå—ï¼Ÿæœ‰è½®å­èƒ½ç›´æ¥ç”¨çš„è¯çœ‹èµ·æ¥å°±ç®€å•å¤šäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†å­¦ä¹ æ•°æ®ç»“æ„çš„å®ç°å°±é¿å…äº†ç›´æ¥ä½¿ç”¨å†…ç½®ç»“æ„
- å“ªäº›ç»å…¸ç®—æ³•é‡Œä½¿ç”¨åˆ°äº†æ ˆå‘¢ï¼Ÿ

# Leetcode ç»ƒä¹ 

https://leetcode.com/problems/implement-queue-using-stacks/




# ç›¸å…³

- [python_data_structures_and_algorithms](https://github.com/PegasusWang/python_data_structures_and_algorithms)
