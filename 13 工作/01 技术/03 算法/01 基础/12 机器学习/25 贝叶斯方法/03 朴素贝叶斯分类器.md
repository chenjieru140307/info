

# 朴素贝叶斯分类器

朴素贝叶斯 Naive Bayesian NB

## 朴素贝叶斯

缘由：

- 计算后验概率时，涉及计算 $P(\boldsymbol x|c)$。
  - 假设样本 $\boldsymbol{x}$ 包含 $d$ 个属性，即 $\boldsymbol{x}=\{ x_1,x_2,...,x_d\}$。
  - 于是有：$
P(\boldsymbol{x}|c_i)=P(x_1,x_2,\cdots,x_d|c_i)$
  - 这个联合概率难以从有限的训练样本中直接估计得到。
- 于是，朴素贝叶斯（Naive Bayesian，简称 NB）采用了“属性条件独立性假设”：对已知类别，假设所有属性相互独立。
  - 于是有：$P(x_1,x_2,\cdots,x_d|c_i)=\prod_{j=1}^d P(x_j|c_i)$
  - 此时，满足条件的 $h$ 为：
  - $h_{nb}(\boldsymbol{x})=\mathop{\arg \max}_{c_i\in Y} P(c_i)\prod_{j=1}^dP(x_j|c_i)$
    - nb 即 Naive Bayesian</span>

求解 $P(x_j|c_i)​$：

- 如果 $x_j$ 是标签属性。
  - 那么我们可以通过计数的方法估计 $P(x_j|c_i)$
  - $P(x_j|c_i)=\frac{P(x_j,c_i)}{P(c_i)}\approx\frac{\#(x_j,c_i)}{\#(c_i)}$
    - 其中，$\#(x_j,c_i)$ 表示在训练样本中 $x_j$ 与 $c_{i}$ 共同出现的次数。
- 如果 $x_j​$ 是数值属性。
  - 通常我们假设类别中 $c_{i}​$ 的所有样本第 $j​$ 个属性的值服从正态分布。
  - 我们首先估计这个分布的均值 $\mu$ 和方差 $\sigma$，然后计算 $x_j​$ 在这个分布中的概率密度 $P(x_j|c_i)​$。（过程补充例子）




疑问：

- 朴素贝叶斯的 属性条件独立性假设怎么达成？需要在使用前用什么方法进行确认是否独立吗？
- 是不是用 PCA 或 LDA  去除线性相关属性之后就可以使用朴素贝叶斯来进行分类了？还说非线性相关的属性也要去掉？在真实工作中要怎么去掉这种相关的属性？怎么知道属性是独立的？

缺点：

- 很多情况下，所有属性两两之间独立，这几乎是不可能的。
  - 举例：Y = 这个人是否是举重运动员。X1 = 性别，X2 = 这个人能否举起 100 公斤的箱子。此时，变量 X1 和 X2 显然不是独立的。
- 由于属性两两独立情况比较少，所以，朴素贝叶斯的预测精度往往不是很高。


**举例：**

样本：

| 编号 | 色泽 | 根蒂 | 敲声 | 纹理 | 脐部 | 触感 | 密度  | 含糖率 | 好瓜 |
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:-----:|:------:|:----:|
|  1   | 青绿 | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.697 | 0.460  |  是  |
|  2   | 乌黑 | 蜷缩 | 沉闷 | 清晰 | 凹陷 | 硬滑 | 0.774 | 0.376  |  是  |
|  3   | 乌黑 | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.634 | 0.264  |  是  |
|  4   | 青绿 | 蜷缩 | 沉闷 | 清晰 | 凹陷 | 硬滑 | 0.608 | 0.318  |  是  |
|  5   | 浅白 | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.556 | 0.215  |  是  |
|  6   | 青绿 | 稍蜷 | 浊响 | 清晰 | 稍凹 | 软粘 | 0.403 | 0.237  |  是  |
|  7   | 乌黑 | 稍蜷 | 浊响 | 稍糊 | 稍凹 | 软粘 | 0.481 | 0.149  |  是  |
|  8   | 乌黑 | 稍蜷 | 浊响 | 清晰 | 稍凹 | 硬滑 | 0.437 | 0.211  |  是  |
|  9   | 乌黑 | 稍蜷 | 沉闷 | 稍糊 | 稍凹 | 硬滑 | 0.666 | 0.091  |  否  |
|  10  | 青绿 | 硬挺 | 清脆 | 清晰 | 平坦 | 软粘 | 0.243 | 0.267  |  否  |
|  11  | 浅白 | 硬挺 | 清脆 | 模糊 | 平坦 | 硬滑 | 0.245 | 0.057  |  否  |
|  12  | 浅白 | 蜷缩 | 浊响 | 模糊 | 平坦 | 软粘 | 0.343 | 0.099  |  否  |
|  13  | 青绿 | 稍蜷 | 浊响 | 稍糊 | 凹陷 | 硬滑 | 0.639 | 0.161  |  否  |
|  14  | 浅白 | 稍蜷 | 沉闷 | 稍糊 | 凹陷 | 硬滑 | 0.657 | 0.198  |  否  |
|  15  | 乌黑 | 稍蜷 | 浊响 | 清晰 | 稍凹 | 软粘 | 0.360 | 0.370  |  否  |
|  16  | 浅白 | 蜷缩 | 浊响 | 模糊 | 平坦 | 硬滑 | 0.593 | 0.042  |  否  |
|  17  | 青绿 | 蜷缩 | 沉闷 | 稍糊 | 稍凹 | 硬滑 | 0.719 | 0.103  |  否  |

测试集：

| 编号 | 色泽 | 根蒂 | 敲声 | 纹理 | 脐部 | 触感 | 密度  | 含糖率 | 好瓜 |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :---: | :----: | :--: |
| 测 1  | 青绿 | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.697 | 0.460  |  ？  |


过程：

- 计算类先验概率 $P(c_j)$：
  - $P_{好瓜=是}=\frac{8}{17}=0.471$
  - $PP_{好瓜=否}=\frac{9}{17}=0.529$
- 为每个属性估计条件概率。
  - 对于标签属性：
    - $P_{色泽=青绿|好瓜=是}=\frac{3}{8}=0.375$
    - $P_{色泽=青绿|好瓜=否}=\frac{3}{9}\approx0.333$
    - $P_{根蒂=蜷缩|好瓜=是}=\frac{5}{8}=0.625$
    - $P_{根蒂=蜷缩|好瓜=否}=\frac{3}{9}=0.333$
    - $P_{敲声=浊响|好瓜=是}=\frac{6}{8}=0.750$
    - $P_{敲声=浊响|好瓜=否}=\frac{4}{9}\approx 0.444$
    - $P_{纹理=清晰|好瓜=是}=\frac{7}{8}= 0.875$
    - $P_{纹理=清晰|好瓜=否}=\frac{2}{9}\approx 0.222$
    - $P_{脐部=凹陷|好瓜=是}=\frac{6}{8}= 0.750$
    - $P_{脐部=凹陷|好瓜=否}=\frac{2}{9} \approx 0.222$
    - $P_{触感=硬滑|好瓜=是}=\frac{6}{8}= 0.750$
    - $P_{触感=硬滑|好瓜=否}=\frac{6}{9} \approx 0.667$
  - 对于连续属性。（我们假定它们服从正态分布）
    - $\begin{aligned}\rho_{密度=0.697|好瓜=是}&=\frac{1}{\sqrt{2 \pi}\times0.129}exp\left( -\frac{(0.697-0.574)^2}{2\times0.129^2}\right) \\&\approx 1.959\end{aligned}$
    - $\begin{aligned}\rho_{密度=0.697|好瓜=否}&=\frac{1}{\sqrt{2 \pi}\times0.195}exp\left( -\frac{(0.697-0.496)^2}{2\times0.195^2}\right) \\&\approx 1.203\end{aligned}$
    - $\begin{aligned}\rho_{含糖=0.460|好瓜=是}&=\frac{1}{\sqrt{2 \pi}\times0.101}exp\left( -\frac{(0.460-0.279)^2}{2\times0.101^2}\right) \\&\approx 0.788\end{aligned}$
    - $\begin{aligned}\rho_{含糖=0.460|好瓜=否}&=\frac{1}{\sqrt{2 \pi}\times0.108}exp\left( -\frac{(0.460-0.154)^2}{2\times0.108^2}\right) \approx 0.066\end{aligned}$
- 于是有
  - $\begin{aligned}P_{测1好瓜是}=&P_{好瓜=是}\times P_{青绿|是} \times P_{蜷缩|是} \\&\times P_{浊响|是} \times P_{清晰|是} \times P_{凹陷|是} \times P_{硬滑|是} \\&\times p_{密度：0.697|是} \times p_{含糖：0.460|是} \\\approx& 0.063\end{aligned}$
  - $\begin{aligned}P_{测1好瓜否}=&P_{好瓜=否}\times P_{青绿|否} \times P_{蜷缩|否} \\&\times P_{浊响|否} \times P_{清晰|否} \times P_{凹陷|否}\times P_{硬滑|否} \\&\times p_{密度：0.697|否} \times p_{含糖：0.460|否} \\\approx& 6.80\times 10^{-5}\end{aligned}$
- 由于 $0.063>6.80\times 10^{-5}$，因此，朴素贝叶斯分类器将测试样本“测 1”判别为“好瓜”。


疑问：

- 上面的 $\rho_{密度：0.697|是}$ 里面的额 0.129 和 0.547 是哪里来的？怎么算的？还有 $\rho_{密度：0.697|否}$ 里面的 0.195 为什么不是 0.129？ 如果是从正太分布来的，那么是怎么基于这几个样本得到一个正态分布的？补充。

## 处理某个类别先验概率为 0 的情况

贝叶斯估计：

$$P\left(X_{j}=X_{j}^{(t e s t)} | Y=C_{k}\right)=\frac{m_{k j} {test} +\lambda}{m_{k}+O_{j} \lambda}$$

说明：

- $O_{j}$ 为第 $j$ 个特征的取值个数
- $\lambda$ 为一个大于 $0$ 的常数，常取 $1$，取 $1$ 时称为拉普拉斯平滑（Laplace smoothing）
- 这种代替，当训练集较多的情况下，可以生成一个接近于 0 的概率代替 0，接近于 $p$ 的概率代替 $p$，几乎不影响原有的先验概率分布。


注意：

- 有时仅对先验概率为 $0$ 的特征采用贝叶斯估计，一般情况下会对所有参与训练的特征都采用贝叶斯估计。（是这样吗？是会对所有参与训练的特征都采用贝叶斯估计吗？）



**举例：**

样本：

|A1|A2|A3|Y|
|:---:|:---:|:---:|:---:|
|1|1|0|1|
|0|1|1|1|
|1|0|1|0|
|0|1|0|0|
|0|0|1|0|

预测：

|A1|A2|A3|Y|
|:---:|:---:|:---:|:---:|
|1|0|0|?|

此时：

- 计算类先验概率 $P(c_j)$：
  - $P_{Y=1}=2/5$
  - $P_{Y=0}=3/5$
- 为每个属性估计条件概率。
  - A1：
    - $P_{A1=1|Y=1}=1/2$
    - $P_{A1=0|Y=1}=1/2$
    - $P_{A1=1|Y=0}=1/3$
    - $P_{A1=0|Y=0}=2/3$
  - A2：
    - $P_{A2=1|Y=1}=2/2$
      - 进行拉普拉斯平滑，即 $\lambda =1$。由于此时，$O_j=2$，得：
      - $P_{A2=1|Y=1}=\frac{2+1}{2+2*1}=3/4$
    - $P_{A2=0|Y=1}=0/2$
      - 进行拉普拉斯平滑，即 $\lambda =1$。由于此时，$O_j=2$，得：
      - $P_{A2=0|Y=1}=\frac{0+1}{2+2*1}=1/4$
    - $P_{A2=1|Y=0}=1/3$
    - $P_{A2=0|Y=0}=2/3$
  - A3：
    - $P_{A3=1|Y=1}=1/2$
    - $P_{A3=0|Y=1}=1/2$
    - $P_{A3=1|Y=0}=2/3$
    - $P_{A3=0|Y=0}=1/3$
- 此时：
  - $P_{测=1}=\frac{2}{5}\times\frac{1}{2}\times\frac{1}{4}\times\frac{1}{2}=1/40$
  - $P_{测=0}=\frac{3}{5}\times\frac{1}{3}\times\frac{2}{3}\times\frac{1}{3}=2/45$
- 因此，测试样本为类别为 0。

