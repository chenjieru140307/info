# EM 算法推导

推导：

- 对 $m$ 个样本 $x=(x^{1},x^{2},...,x^{m})$
- 现在想找出样本的模型参数 $\theta$，其极大化模型分布的对数似然函数为：

$$
\theta = \mathop{\arg\max}_\theta\sum\limits_{i=1}^m logP(x^{(i)};\theta)
$$

- 如果样本数据有未观察到的隐含数据 $z=(z^{(1)},z^{(2)},...z^{(m)})$，那么，极大化模型分布的对数似然函数则为：

$$
\begin{aligned}
\theta =&\mathop{\arg\max}_\theta\sum\limits_{i=1}^m logP(x^{(i)};\theta) 
\\=& \mathop{\arg\max}_\theta\sum\limits_{i=1}^m log\sum\limits_{z^{(i)}}P(x^{(i)}, z^{(i)};\theta)
\end{aligned}
$$

- 由于上式不能直接求出 $\theta$，采用缩放技巧：

$$
\begin{aligned} \sum\limits_{i=1}^m log\sum\limits_{z^{(i)}}P(x^{(i)}, z^{(i)};\theta)   & = \sum\limits_{i=1}^m log\sum\limits_{z^{(i)}}Q_i(z^{(i)})\frac{P(x^{(i)}, z^{(i)};\theta)}{Q_i(z^{(i)})} \\ & \geqslant  \sum\limits_{i=1}^m \sum\limits_{z^{(i)}}Q_i(z^{(i)})log\frac{P(x^{(i)}, z^{(i)};\theta)}{Q_i(z^{(i)})} \end{aligned}   \tag{1}
$$

- 说明：
  - 第一行：引入了一个未知的新分布 $Q_i(z^{(i)})$。
  - 第一行到第二行：使用了 Jensen 不等式：$log\sum\limits_j\lambda_jy_j \geqslant \sum\limits_j\lambda_jlogy_j\;\;,  \lambda_j \geqslant 0, \sum\limits_j\lambda_j =1$

- 此时，如果需要满足 Jensen 不等式中的等号，那么有：

$$\frac{P(x^{(i)}, z^{(i)};\theta)}{Q_i(z^{(i)})} =c, c为常数$$

- 由于 $Q_i(z^{(i)})$ 是一个分布，所以满足

$$\sum\limits_{z}Q_i(z^{(i)}) =1$$

- 综上，可得：

$$\begin{aligned}Q_i(z^{(i)})  =& \frac{P(x^{(i)}， z^{(i)};\theta)}{\sum\limits_{z}P(x^{(i)}, z^{(i)};\theta)} \\=&  \frac{P(x^{(i)}, z^{(i)};\theta)}{P(x^{(i)};\theta)} \\=& P( z^{(i)}|x^{(i)};\theta)\end{aligned}$$

- 也即，此时，如果 $Q_i(z^{(i)}) = P( z^{(i)}|x^{(i)};\theta)$ ，那么 $\geqslant  \sum\limits_{i=1}^m \sum\limits_{z^{(i)}}Q_i(z^{(i)})log\frac{P(x^{(i)}, z^{(i)};\theta)}{Q_i(z^{(i)})}$ 即为我们的 包含隐藏数据的对数似然 的一个下界。
- 如果我们能极大化这个下界，则也就是在尝试极大化我们的对数似然。即我们需要最大化下式：

$$
\mathop{\arg\max}_\theta \sum\limits_{i=1}^m \sum\limits_{z^{(i)}}Q_i(z^{(i)})log\frac{P(x^{(i)}， z^{(i)};\theta)}{Q_i(z^{(i)})}
$$

- 简化得：

$$
\mathop{\arg\max}_\theta \sum\limits_{i=1}^m \sum\limits_{z^{(i)}}Q_i(z^{(i)})log{P(x^{(i)}, z^{(i)};\theta)}
$$


- 说明：
  - $\sum\limits_{z^{(i)}}Q_i(z^{(i)})log{P(x^{(i)}, z^{(i)};\theta)}​$ 可理解为 $logP(x^{(i)}, z^{(i)};\theta)$ 基于条件概率分布 $Q_i(z^{(i)})$ 的期望。

