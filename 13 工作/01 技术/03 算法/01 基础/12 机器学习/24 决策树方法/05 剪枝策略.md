


# 剪枝


剪枝 priming

## 介绍

剪枝：

- 决策树学习算法对付过拟合的主要手段。
- 在决策树学习的时候中，不断的分支，可能会造成过拟合，这个时候就可以通过主动去掉一些分支来降低过拟合的风险。这就是剪枝。



剪枝策略

- 预剪枝 (prepruning)
  - 指，在决策树生成过程中，对每个结点在划分前先进行估计，若当前结点的划分不能带来决策树泛化性能提升，则停止划分并将当前结点标记为叶结点。
- 后剪枝 (post-pruning)
  - 先从训练集生成一棵完整的决策树， 然后自底向上地对非叶结点进行考察，若将该结点对应的子树替换为叶结点能够带来决策树泛化性能提升，那么将该子树替换为叶结点。

怎么衡量泛化性能：

- 可以划分出一个验证集 。然后，看看划分前后，验证集上测试结果的精度变化。



## 预剪枝

- 在决策树生成过程中，对每个结点在划分前先进行估计，若当前结点的划分不能带来决策树泛化性能提升，则停止划分并将当前结点标记为叶结点。

举例：

<p align="center">
    <img width="80%" height="70%" src="http://images.iterate.site/blog/image/20200606/l49IM5SgHc8c.png?imageslim">
</p>


过程：

- 基于信息増益准则，我们选取属性 “脐部” 来对训练集进行划分。
- 查看下，划分前后的泛化性能，来判断是否进行划分。
  - 若如果不进行划分，即，当前结点标记为叶结点。
    - 此时，根据样本数最多的类别，将节点标记为 “好瓜”。
    - 然后，使用验证集对这个单结点的决策树进行评估：
      - 样本 {4,5,8} 分类正确，另外 4 个样本分类错误，那么，这个时候的验证集的精度为 $\frac{3}{7}\times 100\% = 42.9\%$。
  - 如果进行划分。
    - 那么划分之后，分成了 ②、③、④ 三类，分别包含编号为 {1,2,3,14}、{6,7,15,17}、{10,16} 的训练样本，每个结点的类别就是这个结点的样本最多的类别，即： “好瓜”、“好瓜”、“坏瓜”。
    - 然后，我们用验证集对这个决策树进行评估，验证集中编号为 {4,5,8,11,12} 的样例被分类正确，验证集精度为 $\frac{5}{7}\times  100\% =71.4\%$ 。
- $71.4\% > 42.9\%$ ，说明我们可以用 “脐部” 进行划分。


说明：

- 注意预剪枝与决策树的生成时候的区别。
  - 决策树的生成的时候，他实际上是验证的很多的特征，然后看那个特征可以把信息增益做到最大，然后就用哪个特征进行划分。然后才是预剪枝的过程。
  - 预剪枝并不会干涉到特征的选择，只会来看这个已经确定的特征是不是真的要分。


预剪枝优点：

- 降低了过拟合的风险。
- 减少了决策树的训练时间开销和测试时间开销。
  - 而且是显著的降低。因为很多枝连展开都没有展开，后面的划分计算自然就没有了。

预剪枝缺点：

- 预剪枝较为贪心的禁止了某些分支的展开，可能会使得决策树欠拟合。
  - 有些分支的当前划分虽然这次不能提升泛化性能、甚至可能导致泛化性能的暂时下降，但是在它基础上进行的后续划分却是有可能导致性能显著提高的。（这个缺点现在有什么说法吗？）




## 后剪枝

后剪枝：

- 先从训练集生成一棵完整的决策树，如图。这个时候，这个决策树的验证集精度为 42.9%。

<p align="center">
    <img width="80%" height="70%" src="http://images.iterate.site/blog/image/20200606/iyyPGAEDbBs6.png?imageslim">
</p>

- 进行剪枝
  - 先考察图中的结点 ⑥。
    - 如果将 ⑥ 替换为一个叶结点。
    - 由于替换后的叶结点包含着编号为 {7,15} 的训练样本，于是，这个叶结点的类别被标记为 “好瓜”，- 此时，我们看一下决策树在验证集上的精度，为 57.1%。57.1% > 42.9%，因此我们决定剪枝。
  - 接着考察结点 ⑤。
    - 如果将 ⑤ 替换为一个叶结点。
    - 替换后的叶结点包含编号为 {6,7,15} 的训练样例，这个叶结点类别被标记为 “好瓜”
    - 此时的决策树验证集精度仍为 57.1%。于是，我们可以不进行剪枝。
      - 注意：此种情形下检证集精度虽然没有提高，但是根据奥卡姆剃刀准则，剪枝后的模型更好。因此，**一般都是要剪的。** 这里图方便没减而已。
  - 类似的，我们考察结点 ②、结点 ③、结点 ①。
- 最终，得到了下图所示的决策树，其验证集精度为 71.4%。


<p align="center">
    <img width="80%" height="70%" src="http://images.iterate.site/blog/image/20200606/QteLeK6VmeTa.png?imageslim">
</p>





## 预剪枝与后剪枝 对比

- 后剪枝决策树通常比预剪枝决策树保留了更多的分支。
  - 比如，
    - 有些分支，划分的时候验证集精度没有提升，然后就被预剪枝否决了，但是，实际上完全展开的时候，可以展的很深，展的过程中可能存在验证集精度的提高。
    - 而后剪枝来对完全展开的决策树进行剪枝的时候，他遇到这种情况就停下来了。所以后剪枝决策树通常比预剪枝决策树保留了更多的分支。
- 后剪枝欠拟合风险更小一点。
  - 因为：后剪枝可能会展开更多的分支。
- 时间开销方面后剪枝需要更多时间。
  - 因为：后剪枝过程是在生成完全决策树之后进行的，并且要自底向上地对树中的所有非叶结点进行逐一考察，因此其训练时间开销比未剪枝决策树和预剪枝决策树都要大得多。 


