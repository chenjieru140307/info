
# 基于序列学习的文字识别

我们将整行文字识别问题归结为一个序列学习问题。利用基于双向长短期记忆神经网络（Bi-directional Long Short-term Memory，BLSTM）的递归神经网络作为序列学习器，来有效建模序列内部关系。为了引入更有效的输入特征，我们采用卷积神经网络模型来进行特征提取，以描述图像的高层语义。此外在损失函数的设计方面，考虑到输出序列与输入特征帧序列无法对齐，我们直接使用结构化的 Loss（序列对序列的损失），另外引入了背景（Blank）类别以吸收相邻字符的混淆性。

整体网络结构分为三层：卷积层、递归层和翻译层，如下图所示。其中卷积层提取特征；递归层既学习特征序列中字符特征的先后关系，又学习字符的先后关系；翻译层实现对时间序列分类结果的解码。

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190915/SDJUUvSJN6JD.png?imageslim">
</p>


> 基于序列学习的端到端识别框架



对于输入的固定高度 h0= 36的图像（宽度任意，如 W0 = 248），我们通过 CNN 网络结构提取特征，得到 9×62×128的特征图，可将其看作一个长度为 62 的时间序列输入到 RNN 层。RNN层有 400 个隐藏节点，其中每个隐藏节点的输入是 9×128维的特征，是对图像局部区域的描述。考虑到对应于某个时刻特征的图像区域，它与其前后内容都具有较强的相关性，所以我们一般采用双向 RNN 网络，如图 16 所示。

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190915/WNOF9t8l5Fne.png?imageslim">
</p>

> 双向 RNN 序列



双向 RNN 后接一个全连接层，输入为 RNN 层（在某个时刻）输出的特征图，输出为该位置是背景、字符表中文字的概率。全连接层后接 CTC（联结主义时间分类器）作为损失函数。在训练时，根据每个时刻对应的文字、背景概率分布，得到真值字符串在图像中出现的概率 P(ground truth)，将-log(P(ground truth))作为损失函数。在测试时，CTC可以看作一个解码器，将每一时刻的预测结果（当前时刻的最大后验概率对应的字符）联合起来，然后去掉空白和重复的模式，就形成了最终的序列预测结果，如图 17 所示。

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190915/oVbh2LpCXMVt.png?imageslim">
</p>

> CTC解码过程



从图 17 中也可以看出，对应输入序列中的每个字符，LSTM输出层都会产生明显的尖峰，尽管该尖峰未必对应字符的中心位置。换句话说，引入 CTC 机制后，我们不需要考虑每个字符出现的具体位置，只需关注整个图像序列对应的文字内容，最终实现深度学习的端到端训练与预测。

由于序列学习框架对训练样本的数量和分布要求较高，我们采用了真实样本+合成样本的方式。真实样本以美团业务来源（例如，菜单、身份证、营业执照）为主，合成样本则考虑了字体、形变、模糊、噪声、背景等因素。

基于上述序列学习框架，我们给出了在不同场景下的文字行识别结果，如图 18 所示。其中前两行的图片为验证码场景，第三行为银行卡，第四行为资质证件，第五行为门头图，第六行为菜单。可以看到，识别模型对于文字形变、粘连、成像的模糊和光线变化、背景的复杂等都有较好的健壮性。

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190915/guARpdCpS1i2.png?imageslim">
</p>

> 文字行识别结果



基于上述试验，与传统 OCR 相比，我们在多种场景的文字识别上都有较大幅度的性能提升，如图 19 所示：

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190915/JHI65GvY86bv.png?imageslim">
</p>

> 传统 OCR 和深度学习 OCR 性能比较



与传统 OCR 相比，基于深度学习的 OCR 在识别率方面有了大幅上升。但对于特定的应用场景（营业执照、菜单、银行卡等），条目准确率还有待提升。一方面需要融合基于深度学习的文字检测与传统版面分析技术，以进一步提升限制场景下的检测性能。另一方面需要丰富真实训练样本和语言模型，以提升文字识别准确率。



# 相关

- [深度学习在 OCR 中的应用](https://tech.meituan.com/2018/06/29/deep-learning-ocr.html)
