
# GPS 和 IMU 的融合

如上所述，纵使有多路径等问题，GPS是个相对精准的定位传感器，但是GPS的更新频率低，并不能满足实时计算的要求。而惯性传感器的定位误差会随着运行时间增长，但是由于惯性传感器是高频传感器，在短时间内可以提供稳定的实时位置更新。所以，只要我们找到一个方法能融合这两种传感器的优点，各取所长，就可以得到比较实时与精准的定位。

本节介绍如何使用卡尔曼滤波器融合这两种传感器数据。

## 1 卡尔曼滤波器简介

卡尔曼滤波器可以从一组有限的、包含噪声的、通过对物体位置的观察序列预测出物体的位置的坐标及速度。卡尔曼滤波器具有很强的鲁棒性，即使对物体位置的观测有误差，根据物体历史状态与当前对位置的观测，我们可以较准确地推算出物体的位置。

卡尔曼滤波器运行时主要分两个阶段：

- 预测阶段基于上个时间点的位置信息去预测当前的位置信息；
- 更新阶段通过当前对物体位置的观测去纠正位置预测，从而更新物体的位置。

举个具体例子，假设你家停电没有任何灯光，你想从你家客厅走回卧室。你十分清楚客厅与卧室的相对位置，于是你在黑暗中行走，并试图通过计算步数预测你的当前位置。走到一半时，你摸到了电视机。由于你事先知道电视机在客厅的大致位置，于是可以通过你印象中电视机的位置更正你对当前位置的预测，然后在这个调整过的更准确的位置估计的基础上继续依靠计算步数向卧室前行。通过摸黑前行，你依靠计算步数与触摸物体最终从客厅走回了卧室，其背后的道理就是卡尔曼滤波器的核心。

## 3 多传感器融合

如下图所示，使用卡尔曼滤波器对惯性传感器与GPS数据进性融合与上面给出的例子很相似。这里的惯性传感器相当于数步数，而GPS数据相当于电视等参照物的位置。

- 首先，我们在上一次的位置估算的基础上使用惯性传感器对当前的位置进行实时预测。在得到新的GPS数据之前，我们只能通过积分惯性传感器的数据预测当前位置。
- 惯性传感器的定位误差会随着运行时间增长，所以当接收到新的GPS数据时，由于GPS的数据比较精准，我们可以使用GPS数据对当前的位置预测进行更新。

通过不断地执行这两个步骤，我们可以取两者所长，对无人车进行准确的实时定位。


假设惯性传感器的频率是1kHz，而GPS的频率是10Hz，那么每两次GPS更新之间会使用100个惯性传感器数据点进行位置预测。

GPS与IMU的传感器融合定位示意：

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20200208/LzicTh3nSFzQ.png?imageslim">
</p>
