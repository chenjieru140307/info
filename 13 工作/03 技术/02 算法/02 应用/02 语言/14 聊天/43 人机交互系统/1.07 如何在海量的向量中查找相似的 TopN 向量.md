---
title: 1.07 如何在海量的向量中查找相似的 TopN 向量
toc: true
date: 2019-09-04
---


### 18.5.7 如何在海量的向量中查找相似的 TopN 向量？

- **Annoy搜索算法**

Annoy的目标是建立一个数据结构，使得查询一个点的最近邻点的时间复杂度是次线性。Annoy通过建立一个二叉树来使得每个点查找时间复杂度是 O(log n)。 看下面这个图，随机选择两个点，以这两个节点为初始中心节点，执行聚类数为 2 的 kmeans 过程，最终产生收敛后两个聚类中心点。这两个聚类中心点之间连一条线段（灰色短线），建立一条垂直于这条灰线，并且通过灰线中心点的线（黑色粗线）。这条黑色粗线把数据空间分成两部分。在多维空间的话，这条黑色粗线可以看成等距垂直超平面。

<p align="center">
    <img width="70%" height="70%" src="http://images.iterate.site/blog/image/20190722/hjHcu8FC2mtN.jpg?imageslim">
</p>


通过多次递归迭代划分的话，最终原始数据会形成类似下面这样一个二叉树结构。二叉树底层是叶子节点记录原始数据节点，其他中间节点记录的是分割超平面的信息。Annoy建立这样的二叉树结构是希望满足这样的一个假设: 相似的数据节点应该在二叉树上位置更接近，一个分割超平面不应该把相似的数据节点分割二叉树的不同分支上。

    总结：Annoy建立一个数据结构，使得查询一个向量的最近邻向量的时间复杂度是次线性

    步骤：随机选两个点聚类->超平面内分割->构造二叉树->构造多棵树->检索答案合并排序

    注意：第一次查询速度比较慢，是个近似算法，准确率逼近 100%





# 相关

- [DeepLearning-500-questions](https://github.com/scutan90/DeepLearning-500-questions)
